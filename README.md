# Qlik Sense UDP Log Scanner

A Node.js-based diagnostic tool that scans and investigates UDP log messages from the Qlik Sense Enterprise on Windows (QSEoW) Log4Net subsystem. This tool helps you understand what log events are being generated by QSEoW components in real-time.

## Overview

The Qlik Sense Log Scanner listens for UDP messages from Qlik Sense services (Engine, Proxy, Repository, Scheduler, etc.) and provides:

- **Real-time subsystem tracking**: Automatically discovers and tracks all subsystems sending log messages
- **Dynamic search filtering**: Add, remove, and manage search terms while the tool is running
- **Interactive statistics**: View message counts, sender IPs, and search matches in formatted tables
- **Export capabilities**: Export collected data to JSON for further analysis

This tool uses the same UDP message parsing logic as [Butler SOS](https://github.com/ptarmiganlabs/butler-sos), the comprehensive monitoring solution for Qlik Sense Enterprise on Windows.

## Features

- âœ… Parse UDP messages from Qlik Sense Log4Net subsystem
- âœ… Track subsystems and message counts per source (engine, proxy, repository, scheduler, etc.)
- âœ… Automatic discovery notification when new subsystems appear
- âœ… Dynamic search term management (add/remove terms on-the-fly)
- âœ… Highlight messages matching search terms
- âœ… Text-based table display with color-coded output
- âœ… Interactive command-line interface
- âœ… Export data to JSON format
- âœ… Graceful shutdown handling

## Installation

### Prerequisites

- Node.js 14.0.0 or higher
- npm (comes with Node.js)

### Setup

1. Clone the repository:
```bash
git clone https://github.com/ptarmiganlabs/qs-log-scanner.git
cd qs-log-scanner
```

2. Install dependencies:
```bash
npm install
```

3. Configure Qlik Sense to send UDP log messages (see Configuration section below)

## Configuration

### Application Configuration

Edit `config/default.yaml` to customize the scanner:

```yaml
udp:
  port: 9999              # UDP port to listen on
  host: "0.0.0.0"        # Interface to bind to (0.0.0.0 = all interfaces)

display:
  refreshInterval: 5000   # Display refresh interval (ms)
  maxMessagePreview: 100  # Max characters in message previews

logging:
  level: info            # Logging level (error, warn, info, debug)
  logToFile: false       # Enable file logging
  logFilePath: ./logs/scanner.log
```

### Qlik Sense Configuration

Configure Qlik Sense to send log messages via UDP:

1. Open the Qlik Management Console (QMC)
2. Navigate to **Audit** > **Logging**
3. Edit the log appenders for the services you want to monitor
4. Add a UDP appender with:
   - **Host**: IP address where this scanner is running
   - **Port**: 9999 (or your configured port)
   - **Protocol**: UDP

#### Message Types

Qlik Sense can send UDP messages with different source types:

- **Service-specific sources**: `/qseow-engine/`, `/qseow-proxy/`, `/qseow-repository/`, `/qseow-scheduler/`, `/qseow-qix-perf/`
  - These capture log messages from specific Qlik Sense services
  - Each service has its own set of subsystems

- **Generic root source**: `/qseow-root/`
  - **Most generic scenario**: Captures *all* log messages created by the Log4Net framework in QSEoW
  - Use an XML appender that captures all log messages on the Sense server
  - All messages are sent with the `/qseow-root/` source type
  - Provides a comprehensive view of all logging activity across all services

**Recommendation**: Start with `/qseow-root/` to capture all log events, then switch to service-specific sources if you need to focus on particular services.

Refer to Qlik Sense documentation for detailed logging configuration instructions.

## Usage

### Starting the Scanner

Run the scanner with:

```bash
npm start
```

Or directly with Node:

```bash
node src/index.js
```

You should see:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Qlik Sense UDP Log Scanner v1.0.0      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ UDP server listening on 0.0.0.0:9999

=== Qlik Sense Log Scanner ===

Commands:
  stats              - Show current statistics table
  add <term>         - Add a search term
  remove <term>      - Remove a search term
  list               - List all active search terms
  clear              - Clear all search terms
  export [filename]  - Export current data to JSON file
  reset              - Reset all counters
  help               - Show this help
  quit               - Exit the application

Enter command:
```

### Commands Reference

| Command | Description | Example |
|---------|-------------|---------|
| `stats` | Display current statistics table | `stats` |
| `add <term>` | Add a search term to filter messages | `add error` |
| `remove <term>` | Remove a search term | `remove error` |
| `list` | List all active search terms with match counts | `list` |
| `clear` | Clear all search terms | `clear` |
| `export [filename]` | Export data to JSON file | `export data.json` |
| `reset` | Reset all message counters | `reset` |
| `help` | Show command help | `help` |
| `quit` | Exit the application | `quit` |

### Example Workflow

1. **Start the scanner** and wait for messages to arrive
2. **Add search terms** to find specific events:
   ```
   add error
   add timeout
   add failed
   ```
3. **View statistics** to see message distribution:
   ```
   stats
   ```
4. **List search terms** to see which terms have matched:
   ```
   list
   ```
5. **Export data** for further analysis:
   ```
   export my-scan-results.json
   ```

## Example Output

### New Subsystem Discovery

When a new subsystem is discovered, you'll see:

```
[2024-01-15 10:23:45] NEW SUBSYSTEM DISCOVERED: qseow-engine -> Engine.Session

=== All Known Subsystems (sorted) ===
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Source             â”‚ Subsystem                        â”‚ Count    â”‚ Sender IP      â”‚ Search Matches  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ qseow-engine       â”‚ Engine.App                       â”‚ 234      â”‚ 192.168.1.10   â”‚ reload          â”‚
â”‚ qseow-engine       â”‚ Engine.Session                   â”‚ 1        â”‚ 192.168.1.10   â”‚                 â”‚
â”‚ qseow-proxy        â”‚ Proxy.Authentication             â”‚ 892      â”‚ 192.168.1.11   â”‚ login, error    â”‚
â”‚ qseow-proxy        â”‚ Proxy.Connection                 â”‚ 445      â”‚ 192.168.1.11   â”‚                 â”‚
â”‚ qseow-scheduler    â”‚ Scheduler.Task                   â”‚ 67       â”‚ 192.168.1.12   â”‚ failed          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total messages: 1639 | Active search terms: 4 | Unique subsystems: 5
```

### Search Term Match

When a message matches a search term:

```
[2024-01-15 10:25:33] SEARCH MATCH: error, timeout
  Source: qseow-engine
  Subsystem: Engine.App
  Sender: 192.168.1.10
  Message: Connection timeout occurred while loading application 'Sales Dashboard'. Error code: 1001...
```

### Statistics Table

Viewing statistics with the `stats` command:

**Example 1: Service-specific sources**
```
=== Qlik Sense Log Scanner - Statistics ===

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Source             â”‚ Subsystem                        â”‚ Count    â”‚ Sender IP      â”‚ Search Matches  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ qseow-engine       â”‚ Engine.App                       â”‚ 456      â”‚ 192.168.1.10   â”‚ error, reload   â”‚
â”‚ qseow-engine       â”‚ Engine.Session                   â”‚ 1523     â”‚ 192.168.1.10   â”‚ timeout         â”‚
â”‚ qseow-proxy        â”‚ Proxy.Authentication             â”‚ 892      â”‚ 192.168.1.11   â”‚ login, error    â”‚
â”‚ qseow-proxy        â”‚ Proxy.Connection                 â”‚ 445      â”‚ 192.168.1.11   â”‚                 â”‚
â”‚ qseow-repository   â”‚ Repository.Database              â”‚ 234      â”‚ 192.168.1.11   â”‚                 â”‚
â”‚ qseow-scheduler    â”‚ Scheduler.Task                   â”‚ 156      â”‚ 192.168.1.12   â”‚ failed, error   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total messages: 3706 | Active search terms: 5 | Unique subsystems: 6
```

**Example 2: Using `/qseow-root/` (captures all log messages)**
```
=== Qlik Sense Log Scanner - Statistics ===

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Source             â”‚ Subsystem                        â”‚ Count    â”‚ Sender IP      â”‚ Search Matches  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ qseow-root         â”‚ Engine.App                       â”‚ 456      â”‚ 192.168.1.10   â”‚ error, reload   â”‚
â”‚ qseow-root         â”‚ Engine.Session                   â”‚ 1523     â”‚ 192.168.1.10   â”‚ timeout         â”‚
â”‚ qseow-root         â”‚ Proxy.Authentication             â”‚ 892      â”‚ 192.168.1.10   â”‚ login, error    â”‚
â”‚ qseow-root         â”‚ Proxy.Connection                 â”‚ 445      â”‚ 192.168.1.10   â”‚                 â”‚
â”‚ qseow-root         â”‚ Repository.Database              â”‚ 234      â”‚ 192.168.1.10   â”‚                 â”‚
â”‚ qseow-root         â”‚ Scheduler.Task                   â”‚ 156      â”‚ 192.168.1.10   â”‚ failed, error   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total messages: 3706 | Active search terms: 5 | Unique subsystems: 6
```

## UDP Message Format

The scanner parses semicolon-separated UDP messages with the following structure:

| Field | Index | Description |
|-------|-------|-------------|
| Source | 0 | Message source (e.g., `/qseow-engine/`, `/qseow-proxy/`, `/qseow-root/`) |
| Log Row | 1 | Log row number |
| ISO Timestamp | 2 | ISO 8601 timestamp |
| Local Timestamp | 3 | Local timestamp |
| Log Level | 4 | DEBUG, INFO, WARN, ERROR |
| Host | 5 | Hostname |
| **Subsystem** | 6 | **The key field for tracking** |
| Windows User | 7 | Windows user account |
| Message | 8+ | Message content (may contain semicolons) |
| Exception | 9+ | Exception message (if present) |

**Note**: Fields 8 onwards are joined together to handle semicolons in message content.

## Project Structure

```
qs-log-scanner/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js           # Main entry point and orchestration
â”‚   â”œâ”€â”€ udp-server.js      # UDP server setup and message handling
â”‚   â”œâ”€â”€ message-parser.js  # Parse UDP messages into structured objects
â”‚   â”œâ”€â”€ stats-tracker.js   # Track subsystems, counts, and search matches
â”‚   â”œâ”€â”€ search-manager.js  # Manage dynamic search terms
â”‚   â”œâ”€â”€ display.js         # Text-based table display with colors
â”‚   â””â”€â”€ cli.js             # Interactive command line interface
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default.yaml       # Default configuration
â”œâ”€â”€ logs/                  # Log files (if enabled)
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ .gitignore
```

## Technical Details

### Message Parsing

The parser extracts the source by removing leading/trailing slashes and converting to lowercase:
```javascript
let source = msgParts[0].toLowerCase().replace(/\//g, '');
// '/qseow-engine/' becomes 'qseow-engine'
// '/qseow-root/' becomes 'qseow-root'
```

The subsystem is extracted directly from field 6:
```javascript
const subsystem = msgParts[6];
```

Message content from field 8 onwards is joined to handle embedded semicolons:
```javascript
const messageParts = msgParts.slice(8);
const messageContent = messageParts.join(';');
```

### Search Term Matching

Search terms are case-insensitive and match against:
- Message content
- Subsystem name

When matches occur, they are:
- Logged with timestamp and details
- Counted per term
- Associated with the subsystem for display

## Troubleshooting

### No messages received

1. **Check UDP port**: Ensure the configured port (default 9999) is not blocked by firewall
2. **Check Qlik Sense configuration**: Verify UDP appenders are configured correctly in QMC
3. **Check network connectivity**: Ensure Qlik Sense servers can reach the scanner host
4. **Check binding**: Try changing `host` to `0.0.0.0` in config to listen on all interfaces

### Permission denied on port < 1024

Ports below 1024 require elevated privileges on Linux/Unix:
- Use a port >= 1024 (recommended)
- Or run with sudo (not recommended)

### Messages not parsing correctly

Enable debug logging in `config/default.yaml`:
```yaml
logging:
  level: debug
  logToFile: true
  logFilePath: ./logs/scanner.log
```

Check the log file for parsing errors.

## Related Projects

- **[Butler SOS](https://github.com/ptarmiganlabs/butler-sos)**: Comprehensive monitoring solution for Qlik Sense Enterprise on Windows
- **[Butler](https://github.com/ptarmiganlabs/butler)**: Microservice for Qlik Sense Enterprise on Windows

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Contributing

Contributions are welcome! Please feel free to submit issues or pull requests.

## Support

For issues, questions, or contributions, please use the GitHub issue tracker.
